With CTE_BronzeStage as (
SELECT 
      ProgramRef,LayerNum,StatsCcyROE,AnnivDate,DaysNotice,UW,Interest,PolicyId,PolicyRef,EntryType,DecRef,LloydsBrokerId,LloydsBrokerRef,LloydsBrokerContactId,BucketInd,PeriodType,InceptionDate,ExpiryDate,TermsOfTrade,DateWritten,FirstWritten,ClaimInd,Brokerage,Deductions,CancelDate,StatsCcyISO,ConsCcyISO,ConsTotalSyndEPI,ConsTotalSyndExposure,Notes,RenewedFromRef,RenewedToRef,GrossPremIncome,Comm,CommMisc,CoverType,UniqueMarketRef,PlacingType,WordingStatus,PortfolioTransInd,LossOfUseDaily,LastUpd,SectionCode,Period,FullTermPeriod,FullTermInceptionDate,FullTermExpiryDate,FullTermResignInd,ProfitComm,ProfitComm2,CommDeductionsInd,ProfitCommExpense,OtherDeductions,PremFreq,FirstSettDueDate,SettTermOfTrade,AdjTermsOfTrade,CoverMaxPeriod,CommSlideAt,BordereauPremTermsOfTrade,TreatyReinsInd,CoIns,SysLastUpd,NoClaimBonus,EarnPattern,LossOfUseLimit,LossOfUseXs,LossOfUseExposure,LossOfUseCcyISO,LossOfUseXsDsc,CommSlide,CommSlideProv,CommSlideLR,CommSlideMin,BordereauClaimTermsOfTrade,WaitPeriod,SmokerInd,BordereauClaimFreq,Sex,DateOfBirth,QuotaSharePct,BordereauPremFreq,QuotaShareLine,ConvertedInd,IPTPct,IPTPremApplic,RepGroup,SysPolicyType,TotalSyndEPI,TotalSyndExposure,UWDivision,WriteBackPct,LloydsBrokerCode,LloydsBrokerPseud,YOA,PerilGroupId,TerritoryId,TopLimit,TopLimitCcyISO,TopXs,LossOfUseDays,InsDate,DelDate,OtherDeductionsApplyInd,ProfitCommApplyInd,PolicyType,BenefitsType,NoOfLives,Grantee,ProfitCommAdj,PolicyStatus,ParentPolicyId,CancBasis,RemindFreq,RemindDate,RemindMess,RemindEmail,TerritoryIdAssured,BestCode,NAICCode,Producer,Class1,Class2,Class3,GeogCode,TotalSumInsured,CalcFromWritten,BrokerageDeductionsInd,MaxLimit,MinXS,RateFixedInd,TopLimitOrigCcyISO,TopLimitOrigAmount,TopLimitSettAmount,TopLimitConsAmount,TopXSOrigAmount,TopXSSettAmount,TopXSConsAmount,ConsCcyROE,TopLimitSettCcyISO,FILCode,UserName,AggLimit,PaymentMethod,PaymentType,AdjFreq,AdjPcnt,AdjDsc,AdjDate,DWAgreed,ClaimFundInd,NeedReCalcInd,ProfitCommAgreed,Class4,FrontingInd,FinanceUWInd,NOCInd,FullTermInd,EndorsemntInd,FacReinsInd,MonitorPIMInd,DateEntered,UpdBy,MainLayerInd,QuoteDurationDays,UltimateLossRatio,AccountsPayable,BenchMarkRating,InstalmentPeriod,InitialTOT,DeferredTOT,FinalTOT,ConfidentialNotes,LOCInd,ReviewDate,EventName,EventMultiple,OutdoorEventInd,LTPInd,TerrorMiles,TerrorDays,ZipCode,SurveyFees,VetsFees,ConsultancyFees,ExpertFees,AnticipatedLR,PremWarrantyInd,WordingDate,WordingNote,NettLineInd,ReinstBrokerage,LossWarrantyTriggers,LossReviewPct,WarInd,StrikesInd,ExpensesInd,SurveyInd,SurveyDate,NumOfInstalment,SettDueDate,QuoteExpiryDate,QuoteInceptionDate,BureauSettledInd,VenueCity,LORSCode,NoticeToBrokerInsured,NoticeToBrokerInsuredDate,AssuredSignOff,AssuredSignOffDate,TerrorismAPCcy,TerrorismAPAmount,TerrorismAPReceived,TerrorismAPReceivedDate,ZoneA,ZoneB,ZoneC,ZoneD,BusinessInterruption,ManyFacInd,EventPeriod,EventPeriodInception,EventPeriodExpiry,PremiumSwitchDate,PremiumSwitchedInd,RetroDate,MinimumRate,MaximumRate,LossesLoaded,QuotedROL,RetroactiveDate,OldStatsRef,Description,ExternalRef,OrigPRI,OrigCI,UpdPRI,UpdCI,PRIInd,ConfiscationInd,OutwardPolicyInd,PeerReviewDate,PeerReviewInd,ContractCertainty,ContractCertaintyExcpt,ContractCertaintyDate,AggRiskData,ExternalRef2,BUAAInd,PRILossRatioOrig,PRILossRatioUpd,PRINewOldPremOrig,PRINewOldPremUpd,DeficitClause,TruePrice,AdditionalLines,AnticipatedLossRatio,RiskTransfer,LeadInd,ManualMatchingInd,ProcessingType,Indexed,CommutedDate,CommutationOptDate,VerificationStatus,CashLossLimit,ClaimsAgreement,TradeCode,Market,BrokerSettledInd,ScheduleTypeId,DealReference,ExternalRef_COMP,ExternalRef_ForUniqueConstraint,DecRef_ForUniqueConstraint,MasterPolicy,ExternallyProvidedInd,PartVIIInd,SYS_CHANGE_OPERATION
     ,HASHBYTES('SHA1',CONCAT(ProgramRef,'%',LayerNum,'%',StatsCcyROE,'%',AnnivDate,'%',DaysNotice,'%',UW,'%',Interest,'%',PolicyId,'%',PolicyRef,'%',EntryType,'%',DecRef,'%',LloydsBrokerId,'%',LloydsBrokerRef,'%',LloydsBrokerContactId,'%',BucketInd,'%',PeriodType,'%',InceptionDate,'%',ExpiryDate,'%',TermsOfTrade,'%',DateWritten,'%',FirstWritten,'%',ClaimInd,'%',Brokerage,'%',Deductions,'%',CancelDate,'%',StatsCcyISO,'%',ConsCcyISO,'%',ConsTotalSyndEPI,'%',ConsTotalSyndExposure,'%',Notes,'%',RenewedFromRef,'%',RenewedToRef,'%',GrossPremIncome,'%',Comm,'%',CommMisc,'%',CoverType,'%',UniqueMarketRef,'%',PlacingType,'%',WordingStatus,'%',PortfolioTransInd,'%',LossOfUseDaily,'%',LastUpd,'%',SectionCode,'%',Period,'%',FullTermPeriod,'%',FullTermInceptionDate,'%',FullTermExpiryDate,'%',FullTermResignInd,'%',ProfitComm,'%',ProfitComm2,'%',CommDeductionsInd,'%',ProfitCommExpense,'%',OtherDeductions,'%',PremFreq,'%',FirstSettDueDate,'%',SettTermOfTrade,'%',AdjTermsOfTrade,'%',CoverMaxPeriod,'%',CommSlideAt,'%',BordereauPremTermsOfTrade,'%',TreatyReinsInd,'%',CoIns,'%',SysLastUpd,'%',NoClaimBonus,'%',EarnPattern,'%',LossOfUseLimit,'%',LossOfUseXs,'%',LossOfUseExposure,'%',LossOfUseCcyISO,'%',LossOfUseXsDsc,'%',CommSlide,'%',CommSlideProv,'%',CommSlideLR,'%',CommSlideMin,'%',BordereauClaimTermsOfTrade,'%',WaitPeriod,'%',SmokerInd,'%',BordereauClaimFreq,'%',Sex,'%',DateOfBirth,'%',QuotaSharePct,'%',BordereauPremFreq,'%',QuotaShareLine,'%',ConvertedInd,'%',IPTPct,'%',IPTPremApplic,'%',RepGroup,'%',SysPolicyType,'%',TotalSyndEPI,'%',TotalSyndExposure,'%',UWDivision,'%',WriteBackPct,'%',LloydsBrokerCode,'%',LloydsBrokerPseud,'%',YOA,'%',PerilGroupId,'%',TerritoryId,'%',TopLimit,'%',TopLimitCcyISO,'%',TopXs)) as HB100
     ,HASHBYTES('SHA1',CONCAT(LossOfUseDays,'%',InsDate,'%',DelDate,'%',OtherDeductionsApplyInd,'%',ProfitCommApplyInd,'%',PolicyType,'%',BenefitsType,'%',NoOfLives,'%',Grantee,'%',ProfitCommAdj,'%',PolicyStatus,'%',ParentPolicyId,'%',CancBasis,'%',RemindFreq,'%',RemindDate,'%',RemindMess,'%',RemindEmail,'%',TerritoryIdAssured,'%',BestCode,'%',NAICCode,'%',Producer,'%',Class1,'%',Class2,'%',Class3,'%',GeogCode,'%',TotalSumInsured,'%',CalcFromWritten,'%',BrokerageDeductionsInd,'%',MaxLimit,'%',MinXS,'%',RateFixedInd,'%',TopLimitOrigCcyISO,'%',TopLimitOrigAmount,'%',TopLimitSettAmount,'%',TopLimitConsAmount,'%',TopXSOrigAmount,'%',TopXSSettAmount,'%',TopXSConsAmount,'%',ConsCcyROE,'%',TopLimitSettCcyISO,'%',FILCode,'%',UserName,'%',AggLimit,'%',PaymentMethod,'%',PaymentType,'%',AdjFreq,'%',AdjPcnt,'%',AdjDsc,'%',AdjDate,'%',DWAgreed,'%',ClaimFundInd,'%',NeedReCalcInd,'%',ProfitCommAgreed,'%',Class4,'%',FrontingInd,'%',FinanceUWInd,'%',NOCInd,'%',FullTermInd,'%',EndorsemntInd,'%',FacReinsInd,'%',MonitorPIMInd,'%',DateEntered,'%',UpdBy,'%',MainLayerInd,'%',QuoteDurationDays,'%',UltimateLossRatio,'%',AccountsPayable,'%',BenchMarkRating,'%',InstalmentPeriod,'%',InitialTOT,'%',DeferredTOT,'%',FinalTOT,'%',ConfidentialNotes,'%',LOCInd,'%',ReviewDate,'%',EventName,'%',EventMultiple,'%',OutdoorEventInd,'%',LTPInd,'%',TerrorMiles,'%',TerrorDays,'%',ZipCode,'%',SurveyFees,'%',VetsFees,'%',ConsultancyFees,'%',ExpertFees,'%',AnticipatedLR,'%',PremWarrantyInd,'%',WordingDate,'%',WordingNote,'%',NettLineInd,'%',ReinstBrokerage,'%',LossWarrantyTriggers,'%',LossReviewPct,'%',WarInd,'%',StrikesInd,'%',ExpensesInd,'%',SurveyInd,'%',SurveyDate,'%',NumOfInstalment)) as HB200
     ,HASHBYTES('SHA1',CONCAT(SettDueDate,'%',QuoteExpiryDate,'%',QuoteInceptionDate,'%',BureauSettledInd,'%',VenueCity,'%',LORSCode,'%',NoticeToBrokerInsured,'%',NoticeToBrokerInsuredDate,'%',AssuredSignOff,'%',AssuredSignOffDate,'%',TerrorismAPCcy,'%',TerrorismAPAmount,'%',TerrorismAPReceived,'%',TerrorismAPReceivedDate,'%',ZoneA,'%',ZoneB,'%',ZoneC,'%',ZoneD,'%',BusinessInterruption,'%',ManyFacInd,'%',EventPeriod,'%',EventPeriodInception,'%',EventPeriodExpiry,'%',PremiumSwitchDate,'%',PremiumSwitchedInd,'%',RetroDate,'%',MinimumRate,'%',MaximumRate,'%',LossesLoaded,'%',QuotedROL,'%',RetroactiveDate,'%',OldStatsRef,'%',Description,'%',ExternalRef,'%',OrigPRI,'%',OrigCI,'%',UpdPRI,'%',UpdCI,'%',PRIInd,'%',ConfiscationInd,'%',OutwardPolicyInd,'%',PeerReviewDate,'%',PeerReviewInd,'%',ContractCertainty,'%',ContractCertaintyExcpt,'%',ContractCertaintyDate,'%',AggRiskData,'%',ExternalRef2,'%',BUAAInd,'%',PRILossRatioOrig,'%',PRILossRatioUpd,'%',PRINewOldPremOrig,'%',PRINewOldPremUpd,'%',DeficitClause,'%',TruePrice,'%',AdditionalLines,'%',AnticipatedLossRatio,'%',RiskTransfer,'%',LeadInd,'%',ManualMatchingInd,'%',ProcessingType,'%',Indexed,'%',CommutedDate,'%',CommutationOptDate,'%',VerificationStatus,'%',CashLossLimit,'%',ClaimsAgreement,'%',TradeCode,'%',Market,'%',BrokerSettledInd,'%',ScheduleTypeId,'%',DealReference,'%',ExternalRef_COMP,'%',ExternalRef_ForUniqueConstraint,'%',DecRef_ForUniqueConstraint,'%',MasterPolicy,'%',ExternallyProvidedInd,'%',PartVIIInd,'%',SYS_CHANGE_OPERATION)) as HB300
 FROM 
  OPENROWSET(
		BULK 'https://dldpdev01.dfs.core.windows.net/bronze/underwriting/Internal/Eclipse/Staging/dbo_Policy/SystemLoadID=1022022101001/dbo_Policy_1022022101001.parquet',
        FORMAT = 'PARQUET'
    ) AS [result]
 WHERE PolicyId = 1
 )
, CTE_BronzeDelta as (
SELECT 
      BronzeStagingSystemLoadID, ProgramRef,LayerNum,StatsCcyROE,AnnivDate,DaysNotice,UW,Interest,PolicyId,PolicyRef,EntryType,DecRef,LloydsBrokerId,LloydsBrokerRef,LloydsBrokerContactId,BucketInd,PeriodType,InceptionDate,ExpiryDate,TermsOfTrade,DateWritten,FirstWritten,ClaimInd,Brokerage,Deductions,CancelDate,StatsCcyISO,ConsCcyISO,ConsTotalSyndEPI,ConsTotalSyndExposure,Notes,RenewedFromRef,RenewedToRef,GrossPremIncome,Comm,CommMisc,CoverType,UniqueMarketRef,PlacingType,WordingStatus,PortfolioTransInd,LossOfUseDaily,LastUpd,SectionCode,Period,FullTermPeriod,FullTermInceptionDate,FullTermExpiryDate,FullTermResignInd,ProfitComm,ProfitComm2,CommDeductionsInd,ProfitCommExpense,OtherDeductions,PremFreq,FirstSettDueDate,SettTermOfTrade,AdjTermsOfTrade,CoverMaxPeriod,CommSlideAt,BordereauPremTermsOfTrade,TreatyReinsInd,CoIns,SysLastUpd,NoClaimBonus,EarnPattern,LossOfUseLimit,LossOfUseXs,LossOfUseExposure,LossOfUseCcyISO,LossOfUseXsDsc,CommSlide,CommSlideProv,CommSlideLR,CommSlideMin,BordereauClaimTermsOfTrade,WaitPeriod,SmokerInd,BordereauClaimFreq,Sex,DateOfBirth,QuotaSharePct,BordereauPremFreq,QuotaShareLine,ConvertedInd,IPTPct,IPTPremApplic,RepGroup,SysPolicyType,TotalSyndEPI,TotalSyndExposure,UWDivision,WriteBackPct,LloydsBrokerCode,LloydsBrokerPseud,YOA,PerilGroupId,TerritoryId,TopLimit,TopLimitCcyISO,TopXs,LossOfUseDays,InsDate,DelDate,OtherDeductionsApplyInd,ProfitCommApplyInd,PolicyType,BenefitsType,NoOfLives,Grantee,ProfitCommAdj,PolicyStatus,ParentPolicyId,CancBasis,RemindFreq,RemindDate,RemindMess,RemindEmail,TerritoryIdAssured,BestCode,NAICCode,Producer,Class1,Class2,Class3,GeogCode,TotalSumInsured,CalcFromWritten,BrokerageDeductionsInd,MaxLimit,MinXS,RateFixedInd,TopLimitOrigCcyISO,TopLimitOrigAmount,TopLimitSettAmount,TopLimitConsAmount,TopXSOrigAmount,TopXSSettAmount,TopXSConsAmount,ConsCcyROE,TopLimitSettCcyISO,FILCode,UserName,AggLimit,PaymentMethod,PaymentType,AdjFreq,AdjPcnt,AdjDsc,AdjDate,DWAgreed,ClaimFundInd,NeedReCalcInd,ProfitCommAgreed,Class4,FrontingInd,FinanceUWInd,NOCInd,FullTermInd,EndorsemntInd,FacReinsInd,MonitorPIMInd,DateEntered,UpdBy,MainLayerInd,QuoteDurationDays,UltimateLossRatio,AccountsPayable,BenchMarkRating,InstalmentPeriod,InitialTOT,DeferredTOT,FinalTOT,ConfidentialNotes,LOCInd,ReviewDate,EventName,EventMultiple,OutdoorEventInd,LTPInd,TerrorMiles,TerrorDays,ZipCode,SurveyFees,VetsFees,ConsultancyFees,ExpertFees,AnticipatedLR,PremWarrantyInd,WordingDate,WordingNote,NettLineInd,ReinstBrokerage,LossWarrantyTriggers,LossReviewPct,WarInd,StrikesInd,ExpensesInd,SurveyInd,SurveyDate,NumOfInstalment,SettDueDate,QuoteExpiryDate,QuoteInceptionDate,BureauSettledInd,VenueCity,LORSCode,NoticeToBrokerInsured,NoticeToBrokerInsuredDate,AssuredSignOff,AssuredSignOffDate,TerrorismAPCcy,TerrorismAPAmount,TerrorismAPReceived,TerrorismAPReceivedDate,ZoneA,ZoneB,ZoneC,ZoneD,BusinessInterruption,ManyFacInd,EventPeriod,EventPeriodInception,EventPeriodExpiry,PremiumSwitchDate,PremiumSwitchedInd,RetroDate,MinimumRate,MaximumRate,LossesLoaded,QuotedROL,RetroactiveDate,OldStatsRef,Description,ExternalRef,OrigPRI,OrigCI,UpdPRI,UpdCI,PRIInd,ConfiscationInd,OutwardPolicyInd,PeerReviewDate,PeerReviewInd,ContractCertainty,ContractCertaintyExcpt,ContractCertaintyDate,AggRiskData,ExternalRef2,BUAAInd,PRILossRatioOrig,PRILossRatioUpd,PRINewOldPremOrig,PRINewOldPremUpd,DeficitClause,TruePrice,AdditionalLines,AnticipatedLossRatio,RiskTransfer,LeadInd,ManualMatchingInd,ProcessingType,Indexed,CommutedDate,CommutationOptDate,VerificationStatus,CashLossLimit,ClaimsAgreement,TradeCode,Market,BrokerSettledInd,ScheduleTypeId,DealReference,ExternalRef_COMP,ExternalRef_ForUniqueConstraint,DecRef_ForUniqueConstraint,MasterPolicy,ExternallyProvidedInd,PartVIIInd,SYS_CHANGE_OPERATION
     ,HASHBYTES('SHA1',CONCAT(ProgramRef,'%',LayerNum,'%',StatsCcyROE,'%',AnnivDate,'%',DaysNotice,'%',UW,'%',Interest,'%',PolicyId,'%',PolicyRef,'%',EntryType,'%',DecRef,'%',LloydsBrokerId,'%',LloydsBrokerRef,'%',LloydsBrokerContactId,'%',BucketInd,'%',PeriodType,'%',InceptionDate,'%',ExpiryDate,'%',TermsOfTrade,'%',DateWritten,'%',FirstWritten,'%',ClaimInd,'%',Brokerage,'%',Deductions,'%',CancelDate,'%',StatsCcyISO,'%',ConsCcyISO,'%',ConsTotalSyndEPI,'%',ConsTotalSyndExposure,'%',Notes,'%',RenewedFromRef,'%',RenewedToRef,'%',GrossPremIncome,'%',Comm,'%',CommMisc,'%',CoverType,'%',UniqueMarketRef,'%',PlacingType,'%',WordingStatus,'%',PortfolioTransInd,'%',LossOfUseDaily,'%',LastUpd,'%',SectionCode,'%',Period,'%',FullTermPeriod,'%',FullTermInceptionDate,'%',FullTermExpiryDate,'%',FullTermResignInd,'%',ProfitComm,'%',ProfitComm2,'%',CommDeductionsInd,'%',ProfitCommExpense,'%',OtherDeductions,'%',PremFreq,'%',FirstSettDueDate,'%',SettTermOfTrade,'%',AdjTermsOfTrade,'%',CoverMaxPeriod,'%',CommSlideAt,'%',BordereauPremTermsOfTrade,'%',TreatyReinsInd,'%',CoIns,'%',SysLastUpd,'%',NoClaimBonus,'%',EarnPattern,'%',LossOfUseLimit,'%',LossOfUseXs,'%',LossOfUseExposure,'%',LossOfUseCcyISO,'%',LossOfUseXsDsc,'%',CommSlide,'%',CommSlideProv,'%',CommSlideLR,'%',CommSlideMin,'%',BordereauClaimTermsOfTrade,'%',WaitPeriod,'%',SmokerInd,'%',BordereauClaimFreq,'%',Sex,'%',DateOfBirth,'%',QuotaSharePct,'%',BordereauPremFreq,'%',QuotaShareLine,'%',ConvertedInd,'%',IPTPct,'%',IPTPremApplic,'%',RepGroup,'%',SysPolicyType,'%',TotalSyndEPI,'%',TotalSyndExposure,'%',UWDivision,'%',WriteBackPct,'%',LloydsBrokerCode,'%',LloydsBrokerPseud,'%',YOA,'%',PerilGroupId,'%',TerritoryId,'%',TopLimit,'%',TopLimitCcyISO,'%',TopXs)) as HB100
     ,HASHBYTES('SHA1',CONCAT(LossOfUseDays,'%',InsDate,'%',DelDate,'%',OtherDeductionsApplyInd,'%',ProfitCommApplyInd,'%',PolicyType,'%',BenefitsType,'%',NoOfLives,'%',Grantee,'%',ProfitCommAdj,'%',PolicyStatus,'%',ParentPolicyId,'%',CancBasis,'%',RemindFreq,'%',RemindDate,'%',RemindMess,'%',RemindEmail,'%',TerritoryIdAssured,'%',BestCode,'%',NAICCode,'%',Producer,'%',Class1,'%',Class2,'%',Class3,'%',GeogCode,'%',TotalSumInsured,'%',CalcFromWritten,'%',BrokerageDeductionsInd,'%',MaxLimit,'%',MinXS,'%',RateFixedInd,'%',TopLimitOrigCcyISO,'%',TopLimitOrigAmount,'%',TopLimitSettAmount,'%',TopLimitConsAmount,'%',TopXSOrigAmount,'%',TopXSSettAmount,'%',TopXSConsAmount,'%',ConsCcyROE,'%',TopLimitSettCcyISO,'%',FILCode,'%',UserName,'%',AggLimit,'%',PaymentMethod,'%',PaymentType,'%',AdjFreq,'%',AdjPcnt,'%',AdjDsc,'%',AdjDate,'%',DWAgreed,'%',ClaimFundInd,'%',NeedReCalcInd,'%',ProfitCommAgreed,'%',Class4,'%',FrontingInd,'%',FinanceUWInd,'%',NOCInd,'%',FullTermInd,'%',EndorsemntInd,'%',FacReinsInd,'%',MonitorPIMInd,'%',DateEntered,'%',UpdBy,'%',MainLayerInd,'%',QuoteDurationDays,'%',UltimateLossRatio,'%',AccountsPayable,'%',BenchMarkRating,'%',InstalmentPeriod,'%',InitialTOT,'%',DeferredTOT,'%',FinalTOT,'%',ConfidentialNotes,'%',LOCInd,'%',ReviewDate,'%',EventName,'%',EventMultiple,'%',OutdoorEventInd,'%',LTPInd,'%',TerrorMiles,'%',TerrorDays,'%',ZipCode,'%',SurveyFees,'%',VetsFees,'%',ConsultancyFees,'%',ExpertFees,'%',AnticipatedLR,'%',PremWarrantyInd,'%',WordingDate,'%',WordingNote,'%',NettLineInd,'%',ReinstBrokerage,'%',LossWarrantyTriggers,'%',LossReviewPct,'%',WarInd,'%',StrikesInd,'%',ExpensesInd,'%',SurveyInd,'%',SurveyDate,'%',NumOfInstalment)) as HB200
     ,HASHBYTES('SHA1',CONCAT(SettDueDate,'%',QuoteExpiryDate,'%',QuoteInceptionDate,'%',BureauSettledInd,'%',VenueCity,'%',LORSCode,'%',NoticeToBrokerInsured,'%',NoticeToBrokerInsuredDate,'%',AssuredSignOff,'%',AssuredSignOffDate,'%',TerrorismAPCcy,'%',TerrorismAPAmount,'%',TerrorismAPReceived,'%',TerrorismAPReceivedDate,'%',ZoneA,'%',ZoneB,'%',ZoneC,'%',ZoneD,'%',BusinessInterruption,'%',ManyFacInd,'%',EventPeriod,'%',EventPeriodInception,'%',EventPeriodExpiry,'%',PremiumSwitchDate,'%',PremiumSwitchedInd,'%',RetroDate,'%',MinimumRate,'%',MaximumRate,'%',LossesLoaded,'%',QuotedROL,'%',RetroactiveDate,'%',OldStatsRef,'%',Description,'%',ExternalRef,'%',OrigPRI,'%',OrigCI,'%',UpdPRI,'%',UpdCI,'%',PRIInd,'%',ConfiscationInd,'%',OutwardPolicyInd,'%',PeerReviewDate,'%',PeerReviewInd,'%',ContractCertainty,'%',ContractCertaintyExcpt,'%',ContractCertaintyDate,'%',AggRiskData,'%',ExternalRef2,'%',BUAAInd,'%',PRILossRatioOrig,'%',PRILossRatioUpd,'%',PRINewOldPremOrig,'%',PRINewOldPremUpd,'%',DeficitClause,'%',TruePrice,'%',AdditionalLines,'%',AnticipatedLossRatio,'%',RiskTransfer,'%',LeadInd,'%',ManualMatchingInd,'%',ProcessingType,'%',Indexed,'%',CommutedDate,'%',CommutationOptDate,'%',VerificationStatus,'%',CashLossLimit,'%',ClaimsAgreement,'%',TradeCode,'%',Market,'%',BrokerSettledInd,'%',ScheduleTypeId,'%',DealReference,'%',ExternalRef_COMP,'%',ExternalRef_ForUniqueConstraint,'%',DecRef_ForUniqueConstraint,'%',MasterPolicy,'%',ExternallyProvidedInd,'%',PartVIIInd,'%',SYS_CHANGE_OPERATION)) as HB300
  FROM 
  OPENROWSET(
		BULK 'https://dldpdev01.dfs.core.windows.net/bronze/underwriting/Internal/Eclipse/DeltaLake/dbo_Policy/*.parquet',
        FORMAT = 'PARQUET'
    ) AS [result]
 WHERE BronzeStagingSystemLoadID = '1022022101001'
   AND PolicyId = 1
 )

 SELECT STG.PolicyId,STG.HB100,STG.HB200, STG.HB300
       ,TGT.PolicyId,TGT.HB100,TGT.HB200, TGT.HB300
	   ,Case 
	        when STG.HB100 = TGT.HB100 and STG.HB200 = TGT.HB200 and STG.HB300 = TGT.HB300
			then 'Passed' else 'Failed'
	     End as TestResult
  FROM CTE_BronzeStage STG
  Left Join CTE_BronzeDelta TGT  
    on STG.PolicyId = TGT.PolicyId
